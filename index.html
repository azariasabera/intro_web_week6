<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Population Growth Chart</title>
    <!-- Include Frappe Charts library from unpkg -->
    <script src="https://cdn.jsdelivr.net/npm/frappe-charts@latest"></script>
    <style>
        #chart {
            height: 450px;
        }
    </style>
</head>
<body>
    <h1>Population Growth in Finland (2000-2021)</h1>
    <div id="chart"></div>
    
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            fetchPopulationData();
        });

        async function fetchPopulationData() {
            const requestBody = {
                "query": [
                    {
                        "code": "Vuosi",
                        "selection": {
                            "filter": "item",
                            "values": [
                                "2000", "2001", "2002", "2003", "2004", "2005", 
                                "2006", "2007", "2008", "2009", "2010", "2011", 
                                "2012", "2013", "2014", "2015", "2016", "2017", 
                                "2018", "2019", "2020", "2021"
                            ]
                        }
                    },
                    {
                        "code": "Alue",
                        "selection": {
                            "filter": "item",
                            "values": ["SSS"]
                        }
                    },
                    {
                        "code": "Tiedot",
                        "selection": {
                            "filter": "item",
                            "values": ["vaesto"]
                        }
                    }
                ],
                "response": {
                    "format": "json-stat2"
                }
            };

            try {
                const response = await fetch('https://statfin.stat.fi/PxWeb/api/v1/en/StatFin/synt/statfin_synt_pxt_12dy.px', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestBody)
                });
                const data = await response.json();
                mapDataToChart(data);
            } catch (error) {
                console.error('Error fetching population data:', error);
            }
        }

        function mapDataToChart(data) {
            const years = [
                "2000", "2001", "2002", "2003", "2004", "2005", 
                "2006", "2007", "2008", "2009", "2010", "2011", 
                "2012", "2013", "2014", "2015", "2016", "2017", 
                "2018", "2019", "2020", "2021"
            ];

            // Extract population data
            const populationData = years.map(year => {
                const yearIndex = data.dimension.Vuosi.category.index[year];
                return data.value[yearIndex];
            });

            // Initialize the chart
            const chart = new frappe.Chart("#chart", {
                title: "Population Growth in Finland (2000-2021)",
                data: {
                    labels: years,
                    datasets: [
                        {
                            name: "Population", 
                            type: "line",
                            values: populationData
                        }
                    ]
                },
                type: 'line', 
                height: 450,
                colors: ['#eb5146']
            });
        }
    </script>
</body>
</html>
